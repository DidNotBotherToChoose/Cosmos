@page "/"
@using Cosmos.Shared.Models
@inject NavigationManager NavigationManager
@inject IWebApi WebApi
@rendermode InteractiveServer

<MudText Align="Align.Center" Typo="Typo.h3"><b>List of Products</b></MudText>

@* <MudCarousel Class="mud-width-full" ShowArrows="@(product.Images.Count > 1)" ShowBullets="@(product.Images.Count > 1)" ItemsSource="@product?.Images" Style="height:200px" AutoCycle="false"> *@

@if (_products?.Any() == true)
{
    <MudGrid>
        @foreach (var product in _products)
        {
            string imageLink = $"/images/{product.Name}.jpg";

            <MudItem xs="12" sm="6" md="4" lg="3">
                <MudCard Class="w-100 m-2" Style="height: 400px;">
                    <MudCardMedia Image="@imageLink" Height="200" />
                    <MudCardContent>
                        <MudText Typo="Typo.h5">@product.Name</MudText>
                        <MudText Typo="Typo.body2">@product.Description</MudText>
                    </MudCardContent>
                    <MudCardActions>
                        <MudButton Variant="Variant.Text" Color="Color.Default" OnClick="() => Details((int)product?.ProductId)">Details</MudButton>
                        <MudButton Variant="Variant.Text" Color="Color.Error">Delete</MudButton>
                    </MudCardActions>
                </MudCard>
            </MudItem>
        }
    </MudGrid>
}

@code{

    private List<Product> _products = new();

    protected override async Task OnParametersSetAsync()
    {
        try
        {
            _products = await WebApi.GetAllProducts();
        }
        catch (Exception e)
        {
            Console.WriteLine(e);
            throw;
        }
    }

    // private async void DeleteProduct(int? id)
    // {
    //     if(id is not null)
    //     {
    //         var response = await WebApi.DeleteProduct((int)id);
    //     }
    // } 

    private void Details(int? id){
        NavigationManager.NavigateTo($"/product/{id}", true);
    }

    // public class Image
    // {
    //     public string productName { get; set; }
    //     public string Src => $"{productName}.jpg";
    // }
}